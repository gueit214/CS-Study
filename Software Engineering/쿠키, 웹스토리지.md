## 쿠키

### 쿠키

- 브라우저에 저장되는 작은 크기의 문자열이다.
- 최대 4KB까지 저장 가능하고 하나의 도메인 당 20개의 값만 가질 수 있다.
- 이름, 값, 유효시간, 도메인, 요청 경로로 구성되어 있다.

### HTTP

- 비연결성, 무상태성 특징을 가지고 있다.
- 연결을 끊는 순간 클라이언트와 서버의 통신이 끝나며 상태 정보를 유지 하지 않는 특성이다.

### 쿠키 전송 방식

![image](https://github.com/kknyapple/CS-Study/assets/72698829/84ef0cea-829c-4933-ba0e-c315c5270d78)

- 클라이언트가 페이지를 요청한다.
- 서버에서 쿠키를 생성한다.
- HTTP 헤더에 쿠키를 포함 시켜 응답한다.
- 브라우저가 종료되어도 쿠키 만료 기간이 있다면 클라이언트에서 보관하고 있는다.
- 같은 요청을 할  경우 HTTP 헤더에 쿠키를 함께 보낸다.
- 서버에서 쿠키를 읽어 이전 상태 정보를 변경할 필요가 있을 때 쿠키를 업데이트 하여 변경된 쿠키를 HTTP 헤더에 포함 시켜 응답한다.

### 쿠키의 특징

- 주로 서버에서 사용한다.
- 요청 시 Headers에 전송한다.
- 만료 기간을 지정할 수 있다.

### 문제점

- CSRF: 사용자의 권한을 이용한 공격
- XSS: 사용자의 민감한 정보 탈취
- HTTP 요청시 자동으로 모든 쿠키를 계속 서버로 전송해 불필요한 트래픽이 증가한다.

** CSRF: 인증된 사용자가 웹 애플리케이션에 특정 요청을 보내도록 유도하는 공격 행위
** XSS: 악의적인 사용자가 공격하려는 사이트에 스크립트를 넣는 기법

## 웹스토리지

### 웹 스토리지

- window 객체 안에 들어 있다.
- 5MB의 저장 용량을 갖는다.(모바일은 2.5MB, 부족하다면 50MB를 저장할 수 있는 IndexedDB)
- 요청 시 Headers에 전송하지 않는다.(쿠키의 CSFR, 트래픽 문제 해결)
- 직렬화를 통해 객체를 저장 가능하다.

### 로컬 스토리지

- 도메인/브라우저 별로 독립된 스토리지를 사용한다.
- 직접 삭제하지 않는 이상 유지된다.

### 세션 스토리지

- 탭 별로 독립된 스토리지를 사용한다.
- 탭 종료 시 스토리지가 삭제된다.

### 문제점

- XSS: 자바스크립트로 접근 가능
- 독립된 스토리지로 브라우저, 탭 간 공유가 불가하다.
- 만료 기간 설정이 불가하다.
- 동기적으로 실행해 메인 스레드를 블로킹할 수 있다.

## 정리

### 쿠키

- 기간 설정, 서버 전송이 가능하다.
- n일 동안 보지 않기, 쇼핑몰 장바구니, 자동 로그인

### 세션 스토리지

- 탭 종료 시 삭제된다.
- 이전 페이지 저장, 이전 스크롤 위치 저장

### 로컬 스토리지

- 브라우저 종료 시 유지된다.
- 사용자 설정 저장, 글 임시 저장

### 쿠키 보안 문제 해결 방안

- XSS: HttpOnly를 추가해 자바스크립트로 접근이 불가하게 한다.
- CSRF: SameSite로 같은 도메인의 요청에만 쿠키를 전송한다.

** HttpOnly: 클라이언트 측에서 HTTP 통신외에는 Cookie에 접근이 불가능 하도록 하는 것

### 웹 스토리지 보안 문제 해결 방안

- XSS: innerHTML, document.write 등을 사용하지 않는다. 사용자의 입력이 자바스크립트 코드로 실행될 수 있는 코드를 작성하지 않는다.
- innerHTML 사용지 XSS 보안 라이브러리를 사용한다.(sanitize-html, DOMPurify)

## 참고

- [https://racoonlotty.tistory.com/entry/쿠키와-세션-그리고-로컬-스토리지와-세션-스토리지](https://racoonlotty.tistory.com/entry/%EC%BF%A0%ED%82%A4%EC%99%80-%EC%84%B8%EC%85%98-%EA%B7%B8%EB%A6%AC%EA%B3%A0-%EB%A1%9C%EC%BB%AC-%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80%EC%99%80-%EC%84%B8%EC%85%98-%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80)

- https://velog.io/@alang/XSS-%EA%B3%B5%EA%B2%A9%EA%B3%BC-%EC%BF%A0%ED%82%A4%EC%9D%98-HttpOnly
