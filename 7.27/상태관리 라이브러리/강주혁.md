> 본인이 사용하는 상태관리 라이브러리를 적용하는데 있어 생각하는 원칙이나 방향성에 대해서 말해보세요

# state(상태)

## 상태란 뭘까?

렌더링에 영향을 미치는 모든 데이터를 말한다. UI에 영향을 줄 수 있는 모든 데이터라고 생각하면 될 것 같다.

## 상태관리는 뭘까?

상태를

- 어디에 저장하고
- 어떻게 변화를 일으키고
- 어떻게 감지하고
- 어떻게 그 변화를 전파하고
- 어떻게 상황에 따라 가공해서 보여주고

하는 것? 즉, `상태의 변화/전파를 처리하는 방법`이라고 정의할 수 있을 것 같다.

## 상태의 종류

관점에 따라 다를 것 같지만 나는 다음과 같이 나눌 수 있을 것 같다.

- Client state
- Server state

### Client state

- 클라이언트가 제어 및 소유하는 데이터
- 동기적인 상태
- UI 상태

### Server state

- 서버로부터 불러오는 데이터(특정 시점의 데이터)
- 비동기적인 상태

## 어떻게 관리하는게 좋을까?

이 상태들을 지역적으로 관리해서 props drilling으로 전달하는 방법이 있고, 전역적으로 관리해서 필요한 곳에서 가져다 쓰는 방법이 있다.

어떤 원칙이나 방향성을 가지고 상태를 관리해야할까?

### 상태의 범위를 구분하여 관리하자

상태를 사용하는 범위를 적절하게 구분해서 관리해야한다.

특정 컴포넌트 내부에서만 사용되는 상태라면 그 컴포넌트 내부에서 관리하는 것이 좋다.

만약 전역적으로, 모든 곳에서 사용되는 상태라면 전역적으로 관리하는 것이 좋다.

상태를 공유하게 되면 컴포넌트들끼리 의존성이 생기게 되고, 범위를 잘못 설정하게 된다면 불필요한 리렌더링 혹은 side effect가 발생할 수 있다.

**최대한 필요한 곳에만 변화가 전파되어야 한다.** 상태를 가능한 한 그 상태를 필요로 하는 곳 근처에 두자.

#### 그럼 전역 상태 라이브러리는 언제 사용해야 할까?

`전역 상태`는 말 그대로 프로젝트 전역에서 사용되는 상태를 말한다.

전역 상태라고 하면 theme이나, 언어, 로그인 상태 같은거라고 생각하면 될 것 같다.

하지만 전역 상태 라이브러리를 사용하면 최적화도 잘 되어있고 편하니까 아무 곳이나 사용하게 되기도 한다. 이렇게 되면 "전역 상태"의 의미가 퇴색된다.

전역으로 관리가 필요한 상태는 설계만 잘하면 생각보다 별로 없다. 보통 상태는 특정 페이지 안에서 사용되는 경우가 많다. 나는 그래서 전역 상태 라이브러리를 사용하는 것을 지양한다.

대신 Context API로 Provider로 묶어 범위를 한정짓고 사용한다. 물론 리렌더링 이슈도 있지만, 이 또한 context value에 들어갈 상태를 잘 설정하고 관리하면 큰 문제가 되지 않는다.

다만 너무 복잡한 경우가 있을 수 있다. 그런 경우엔 전역 상태 라이브러리를 도입하는 걸 고려해 볼 수도 있겠다.

> 여담  
> 어떤 기술, 방법을 선택한다는 것은 어떤 것을 포기하고 어떤 것을 선택하는 것이다. 실무적인 관점에서 보았을 때 팀에 기술을 도입함으로써 얻는 이점은 무엇인지, 손해보는 것은 어떤건지 고려해야 한다.  
> 기술을 도입하면 편하고 좋을 수 있지만, 현재 상황이 어떤지부터 파악해야한다.  
> 만약 react-query 같은 라이브러리를 쓰지 않았을 때 어떤 문제가 있었고, 도입했을 때 어떤 이득을 취할 수 있는지, 반대로 도입하게되면 수정해야할 코드가 많을 수도 있고 러닝커브가 있어 개발 속도가 느려질 수도 있다.  
> 상황에 맞게 도입하는 판단력도 최근에 많이 보는 것 같다..

### 어떻게 저장하고 갱신할 지 고민하고 설계하자

상태 중에서 너무 많은 변화가 있어 캐싱해서는 안되는 데이터가 있을 수 있고, 반대로 변화가 너무 없어 서버에 요청하는 것이 불필요한 데이터가 있을 수 있다.

전자는 웹소켓응 사용해서 관리하는 방법이 있겠고, 후자인 경우엔 로컬 스토리지나 쿠키 같은 곳에 저장해두어 캐싱할 수 있다.

만약에 그냥 매번 API call이 일어나게 된다면 리소스 낭비가 심할 것이다.

어떻게 상태를 저장하고 갱신할 지 고민하고 설계해야 한다.
